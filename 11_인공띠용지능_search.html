<!DOCTYPE html>
<html lang="ko" id="top">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>냠냠노트 - 레시피 검색 결과</title>
    <link rel="stylesheet" href="11_인공띠용지능_NamyamNote_style.css" />
  </head>

  <body>
    <!-- ✅ 메인 페이지와 동일한 네비 -->
    <nav class="site-nav">
  <div class="container nav-top-center">
    <div class="nav-center-box">
      <a href="11_인공띠용지능_main.html" aria-label="냠냠노트 홈">
        <img src="11_logo.png" alt="냠냠노트 로고" class="logo" />
      </a>

      <div class="nav-search">
        <input
          type="text"
          placeholder="재료명으로 레시피 검색"
          class="nav-search-input"
        />
        <button class="nav-search-btn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <circle cx="11" cy="11" r="7" stroke="white" stroke-width="2" />
            <line x1="16.5" y1="16.5" x2="21" y2="21" stroke="white" stroke-width="2" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <div class="nav-menu-bar">
    <a class="nav-link" href="11_인공띠용지능_main.html">홈</a>
    <a class="nav-link" href="11_인공띠용지능_menulist.html">레시피</a>
    <a class="nav-link" href="11_인공띠용지능_register.html">등록</a>
    <a class="nav-link" href="11_인공띠용지능_rank.html">랭킹</a>
    <a class="nav-link" href="11_인공띠용지능_mypage.html">마이페이지</a>
  </div>
</nav>


    <!-- ----------------------------- -->
    <!--           MAIN                -->
    <!-- ----------------------------- -->

    <main class="page-pad">
      <div id="ranking" class="container">
        <header class="hero center">
          <h1 class="mt-0">
            <span id="keyword-text"></span> 검색 결과
          </h1>
          <p style="font-size: 14px; color: var(--muted)">
            총 <span id="result-count">0</span>개의 레시피를 찾았어요.
          </p>
        </header>

        <h2 class="section-title">검색된 레시피</h2>

        <div id="search-result" class="ranking-list mt-20"></div>
      </div>
    </main>

    <a href="#top" class="to-top">맨 위로 ↑</a>

    <script>
      // -----------------------------
      // URL에서 검색어 추출
      // -----------------------------
      const params = new URLSearchParams(window.location.search);
      const keyword = (params.get("keyword") || "").trim();

      document.getElementById("keyword-text").textContent = keyword
        ? `"${keyword}"`
        : "전체";

      const resultCountEl = document.getElementById("result-count");
      const resultBox = document.getElementById("search-result");

      // -----------------------------
      // 레시피 JSON 로드
      // -----------------------------
      fetch("11_인공띠용지능_recipes.json")
        .then((res) => res.json())
        .then((data) => {
          const recipes = data.recipes || [];
          const found = filterRecipes(recipes, keyword);
          resultCountEl.textContent = found.length;

          if (found.length === 0) {
            resultBox.innerHTML = `
              <div class="card-box mt-20 center">
                <p class="card-title-lg">"${keyword}"에 대한 검색 결과가 없습니다.</p>
                <p style="font-size:14px; color:var(--muted); margin-top:8px;">
                  다른 재료명이나 요리 이름으로 다시 검색해보세요.
                </p>
              </div>`;
            return;
          }

          // -----------------------------
          // 검색 결과 카드 렌더링 (순위 제거)
          // -----------------------------
          resultBox.innerHTML = found
            .map((item) => {
              const rating = item.rating ?? 0;
              const reviewCount = item.review_count ?? 0;
              const summary =
                item.summary ||
                `${item.category || "요리"} · 검색된 레시피`;

              return `
              <a href="11_인공띠용지능_recipe.html?id=${item.id}" class="rank-card">

                <img
                  src="${item.thumbnail}"
                  class="rank-card-image"
                  alt="${item.title}"
                />

                <div class="rank-info">
                  <h2 class="rank-title">${item.title}</h2>
                  <p class="rank-description">${summary}</p>
                </div>

                <div class="rank-meta">
                  <div class="rank-rating">★ ${rating}</div>
                  <p class="rank-views">조회수 ${reviewCount}개</p>
                </div>
              </a>
            `;
            })
            .join("");
        });

      // 검색 필터 함수
      function filterRecipes(recipes, keyword) {
        if (!keyword) return recipes;
        const lower = keyword.toLowerCase();

        return recipes.filter((recipe) => {
          const titleMatch =
            recipe.title?.toLowerCase().includes(lower);
          const categoryMatch =
            recipe.category?.toLowerCase().includes(lower);

          const ingredients = recipe.ingredients_required || [];
          const ingredientMatch = ingredients.some((i) =>
            (i.name || "").toLowerCase().includes(lower)
          );

          return titleMatch || categoryMatch || ingredientMatch;
        });
      }

      // -----------------------------
      // 네비바 검색 (메인 동일)
      // -----------------------------
      const navInput = document.querySelector(".nav-search-input");
      const navBtn = document.querySelector(".nav-search-btn");

      navBtn.addEventListener("click", () => {
        const kw = navInput.value.trim();
        if (!kw) return alert("검색어를 입력해주세요!");
        location.href =
          "11_인공띠용지능_search.html?keyword=" +
          encodeURIComponent(kw);
      });

      navInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") navBtn.click();
      });
    </script>
  </body>
</html>

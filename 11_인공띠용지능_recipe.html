<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title id="page-title">ëƒ ëƒ ë…¸íŠ¸ - ë ˆì‹œí”¼</title>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link rel="stylesheet" href="11_ì¸ê³µë ìš©ì§€ëŠ¥_NamyamNote_style.css" />
  </head>
  <body>
    <nav class="site-nav">
      <div class="container nav-inner">
        <div class="logo-area">
          <a href="11_ì¸ê³µë ìš©ì§€ëŠ¥_main.html" class="logo">
            <img src="11_logo.png" alt="ëƒ ëƒ ë…¸íŠ¸ ë¡œê³ " class="logo-img" />
          </a>
        </div>
        <div class="menu">
          <a href="11_ì¸ê³µë ìš©ì§€ëŠ¥_main.html" class="nav-link">í™ˆ</a>
          <a href="11_ì¸ê³µë ìš©ì§€ëŠ¥_menulist.html#all" class="active nav-link"
            >ë ˆì‹œí”¼</a
          >
          <a href="11_ì¸ê³µë ìš©ì§€ëŠ¥_register.html" class="nav-link">ë“±ë¡</a>
          <a href="11_ì¸ê³µë ìš©ì§€ëŠ¥_rank.html#ranking" class="nav-link">ë­í‚¹</a>
          <a href="11_ì¸ê³µë ìš©ì§€ëŠ¥_mypage.html" class="nav-link">ë§ˆì´í˜ì´ì§€</a>
        </div>
      </div>
    </nav>

    <main class="page-pad">
      <div class="container">
        <section class="hero">
          <img
            id="thumb"
            style="
              width: 100%;
              height: 600px;
              object-fit: cover;
              border-radius: 12px;
            "
          />

          <div>
            <h1 id="recipe-title" style="margin-top: 30px"></h1>
            <p id="recipe-summary" class="mt-20"></p>

            <div class="mt-20">
              <span id="recipe-category" class="badge-green"></span>
              <span>ë‚œì´ë„: <strong id="recipe-difficulty"></strong></span>
              <span>ì¡°ë¦¬ ì‹œê°„: <strong id="recipe-time"></strong></span>
            </div>

            <div id="recipe-rating" class="rating"></div>

            <div class="btn-row">
              <button class="btn-solid" id="btn-save">
                <i class="fas fa-heart"></i> ì €ì¥í•˜ê¸°
              </button>

              <button class="btn-outline" id="btn-share">
                <i class="fas fa-share-alt"></i> ê³µìœ 
              </button>
            </div>
          </div>
        </section>

        <div class="grid-2 gap-24 mt-80">
          <section class="card-box">
            <h2 class="card-title-lg">í•„ìˆ˜ ì¬ë£Œ</h2>
            <ul id="ingredients-required" class="list-v"></ul>

            <h3 class="section-title mt-20">ì„ íƒ ì¬ë£Œ</h3>
            <ul id="ingredients-optional" class="list-v"></ul>
          </section>

          <section class="card-box">
            <h2 class="card-title-lg">ì¡°ë¦¬ ê³¼ì •</h2>
            <ol id="recipe-steps" class="list-v"></ol>
          </section>
        </div>

        <section class="card-box mt-80">
          <h2 id="review-title" class="card-title-lg"></h2>

          <div class="review-area">
            <div class="review-input-box">
              <textarea
                class="input-text"
                placeholder="ì´ ë ˆì‹œí”¼ì— ëŒ€í•œ ë‹¹ì‹ ì˜ ë¦¬ë·°ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”!"
              ></textarea>

              <div class="btn-row between">
                <div class="rating-stars">
                  <i class="far fa-star"></i>
                  <i class="far fa-star"></i>
                  <i class="far fa-star"></i>
                  <i class="far fa-star"></i>
                  <i class="far fa-star"></i>
                </div>

                <button class="btn-solid">ë¦¬ë·° ë“±ë¡</button>
              </div>
            </div>

            <div id="review-list" class="review-list"></div>
          </div>
        </section>
      </div>
    </main>

    <a href="#top" class="to-top">ë§¨ ìœ„ë¡œ â†‘</a>

    <script src="11_ì¸ê³µë ìš©ì§€ëŠ¥_recipeLoader.js"></script>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const saveBtn = document.getElementById('btn-save');
        const STORAGE_KEY = 'nn_saved_recipes';

        const urlParams = new URLSearchParams(window.location.search);
        const recipeId =
          urlParams.get('id') || urlParams.get('recipe') || 'unknown_recipe';

        function setSavedState(isSaved) {
          if (!saveBtn) return;
          if (isSaved) {
            saveBtn.innerHTML = '<i class="fas fa-check"></i> ì €ì¥ë¨';
          } else {
            saveBtn.innerHTML = '<i class="fas fa-heart"></i> ì €ì¥í•˜ê¸°';
          }
        }

        function isAlreadySaved(list) {
          return list.some((item) => String(item.id) === String(recipeId));
        }

        if (saveBtn) {
          let savedRecipes = [];
          try {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (raw) {
              const parsed = JSON.parse(raw);
              if (Array.isArray(parsed)) savedRecipes = parsed;
            }
          } catch (e) {
            console.error('ì €ì¥ëœ ë ˆì‹œí”¼ íŒŒì‹± ì˜¤ë¥˜:', e);
          }
          setSavedState(isAlreadySaved(savedRecipes));

          saveBtn.addEventListener('click', function () {
            const titleEl = document.getElementById('recipe-title');
            const categoryEl = document.getElementById('recipe-category');
            const thumbEl = document.getElementById('thumb');
            const ratingEl = document.getElementById('recipe-rating');

            const title = titleEl
              ? titleEl.innerText.trim()
              : 'ì œëª© ì—†ëŠ” ë ˆì‹œí”¼';
            const category = categoryEl ? categoryEl.innerText.trim() : 'ê¸°íƒ€';
            const subInfo = `${category} Â· ì €ì¥ëœ ë ˆì‹œí”¼`;
            const thumbnail = thumbEl
              ? thumbEl.getAttribute('src')
              : '11_default.png';

            let rating = 0;
            let reviewCount = 0;
            if (ratingEl) {
              const dataRating = ratingEl.getAttribute('data-rating');
              const dataReview = ratingEl.getAttribute('data-review-count');
              if (dataRating) rating = Number(dataRating) || 0;
              if (dataReview) reviewCount = Number(dataReview) || 0;
            }

            let list = [];
            try {
              const raw = localStorage.getItem(STORAGE_KEY);
              if (raw) list = JSON.parse(raw);
            } catch (e) {}

            const idx = list.findIndex(
              (item) => String(item.id) === String(recipeId)
            );

            if (idx !== -1) {
              list.splice(idx, 1);
              alert('ì €ì¥ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
              setSavedState(false);
            } else {
              const recipeData = {
                id: recipeId,
                title: title,
                subInfo: subInfo,
                link:
                  '11_ì¸ê³µë ìš©ì§€ëŠ¥_recipe.html?id=' +
                  encodeURIComponent(String(recipeId)),
                thumbnail: thumbnail,
                rating: rating,
                review_count: reviewCount,
              };
              list.push(recipeData);
              alert('ë ˆì‹œí”¼ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
              setSavedState(true);
            }
            localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
          });
        }

        const shareBtn = document.getElementById('btn-share');

        if (shareBtn) {
          shareBtn.addEventListener('click', function () {
            const currentUrl = window.location.href;

            navigator.clipboard
              .writeText(currentUrl)
              .then(() => {
                alert(
                  'ë ˆì‹œí”¼ ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ”—\nì¹œêµ¬ë“¤ì—ê²Œ ê³µìœ í•´ë³´ì„¸ìš”.'
                );
              })
              .catch((err) => {
                console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
                alert(
                  'ì£¼ì†Œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. URLì„ ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”.\n' +
                    currentUrl
                );
              });
          });
        }
      });
    </script>
  </body>
</html>

<!DOCTYPE html>
<html lang="ko" id="top">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>냠냠노트 - 마이페이지</title>
    <link rel="stylesheet" href="11_인공띠용지능_NamyamNote_style.css" />
    <style>
      .follow {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: #f9fafb;
        border-top: 1px solid var(--border);
        padding: 12px 8px;
      }

      .follow > div {
        flex: 1;                 
        text-align: center;
      }

      .follow-num {
        display: block;
        color: var(--text);
        font-size: 20px;
        font-weight: 800;
      }

      .follow-label {
        display: block;
        color: var(--muted);
        font-size: 13px;
      }
      .profile-box {
        display: flex;
        flex-direction: column;
        align-items: center !important;  
        text-align: center;              
      }

    </style>
  </head>
  <body>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const savedNickname = localStorage.getItem("nn_nickname");
        const savedUsername = localStorage.getItem("nn_username");
        const savedBio = localStorage.getItem("nn_bio");
        const savedProfileImg = localStorage.getItem("nn_profile_img");
        const savedBgImg = localStorage.getItem("nn_bg_img");

        if (savedNickname) {
          document.querySelector(".profile-name").textContent = savedNickname;
        }
        if (savedUsername) {
          document.querySelector(".profile-id").textContent = savedUsername;
        }
        if (savedBio) {
          document.querySelector(".profile-bio").textContent = savedBio;
        }
        if (savedProfileImg) {
          document.querySelector('.profile-box img').src = savedProfileImg;
        }
        if (savedBgImg) {
          document.querySelector('.profile-cover').style.backgroundImage = `url('${savedBgImg}')`;
        }

        const logoutBtn = document.querySelector('a[href="#logout"]');
        if (logoutBtn) {
          logoutBtn.addEventListener("click", function (e) {
            e.preventDefault();
            const confirmLogout = confirm("정말 로그아웃 하시겠습니까?");
            if (confirmLogout) {
              alert("로그아웃 되었습니다.");
              window.location.href = "11_인공띠용지능_main.html";
            }
          });
        }

        
      });
  </script>
    <nav class="site-nav">
      <div class="container nav-inner">
        <div class="logo-area">
          <a href="11_인공띠용지능_main.html">
            <img src="11_logo.png" alt="냠냠노트 로고" class="logo-img" />
          </a>
        </div>

        <nav class="menu">
          <a href="11_인공띠용지능_main.html" class="nav-link">홈</a>
          <a href="11_인공띠용지능_menulist.html" class="nav-link">레시피</a>
          <a href="11_인공띠용지능_register.html" class="nav-link">등록</a>
          <a href="11_인공띠용지능_rank.html" class="nav-link">랭킹</a>
          <a href="11_인공띠용지능_mypage.html" class="nav-link active">마이페이지</a>
        </nav>
      </div>
    </nav>

    <main class="container page-pad">
      <section class="profile-header">
        <div class="profile-cover" role="img"></div>
        <div class="profile-box">
          <div style="margin-top: -43px; width: 88px; height: 88px">
            <img
              src="11_circle_h_icon.png"
              alt="프로필 이미지"
              style="width: 100%; height: 100%"
            />
          </div>
          <div style="text-align: center">
            <h1 class="profile-name">Haein_Cook</h1>
            <p class="profile-id">@haein_cook</p>
            <p class="profile-bio">안녕하세요!</p>
            <div style="margin-top: 20px">
              <a href="11_인공띠용지능_edit-profile.html" class="btn-outline"
                >프로필 수정</a
              >
            </div>
          </div>
        </div>
        <div class="follow">
          <div style="text-align: center">
            <strong class="follow-num">8</strong>
            <span class="follow-label">내 레시피</span>
          </div>
          <div style="text-align: center">
            <strong class="follow-num">325</strong>
            <span class="follow-label">팔로잉</span>
          </div>
          <div style="text-align: center">
            <strong class="follow-num">238</strong>
            <span class="follow-label">팔로워</span>
          </div>
        </div>
      </section>

      <section class="grid-2" style="gap: 24px; margin-top: 80px">
        <div class="card-box">
          <div class="bar" style="justify-content: space-between">
            <h3 class="card-title-lg">저장한 레시피</h3>
            <a href="#" class="badge">더보기</a>
          </div>
          <ul class="list-v" id="saved-list">
          </ul>
        </div>

        <div class="card-box">
          <div class="bar" style="justify-content: space-between">
            <h3 class="card-title-lg">최근 본 레시피</h3>
            <a href="#" class="badge">더보기</a>
          </div>
          <ul class="list-v" id="recent-list">
          </ul>
        </div>
      </section>

      <section class="card-box" style="margin-top: 80px">
        <div class="bar" style="justify-content: space-between">
          <h3 class="card-title-lg">내가 등록한 레시피</h3>
          <div class="btn-row">
            <a href="11_인공띠용지능_register.html" class="btn-solid"
              >새 레시피 등록
            </a>
            <a href="11_인공띠용지능_recipe_manage.html" class="btn-warn">레시피 관리</a>


          </div>
        </div>

        <div class="card-grid my-recipes" id="my-recipes-grid">
        </div>
      </section>

      <div style="margin-top: 20px; text-align: right">
        <a href="#logout" class="btn-warn">
          <span>로그아웃</span>
        </a>
      </div>

      <a href="#top" class="to-top" aria-label="맨 위로 이동">맨 위로 ↑</a>
    </main>
    <script>
 
    const LOCAL_RECIPES_KEY = "nn_recipes";
    const SAVED_RECIPES_KEY = "nn_saved_recipes";
    const RECENT_RECIPES_KEY = "nn_recent_recipes";

 
    function loadLocalRecipes() {
      try {
        const raw = localStorage.getItem(LOCAL_RECIPES_KEY);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [];
      } catch (e) {
        console.error("내 레시피 로드 오류:", e);
        return [];
      }
    }


    function renderMyRecipeCount(list) {
      const count = list.length;
      const followNums = document.querySelectorAll(".follow-num");
      if (followNums.length > 0) {
   
        followNums[0].textContent = count;
      }
    }


    function renderMyRecipesGrid(list) {
      const grid =
        document.getElementById("my-recipes-grid") ||
        document.querySelector(".card-grid.my-recipes");
      if (!grid) return;

      if (list.length === 0) {
        grid.innerHTML =
          '<p class="card-sub muted">아직 등록한 레시피가 없습니다. 상단의 "새 레시피 등록" 버튼으로 첫 레시피를 만들어보세요!</p>';
        return;
      }

      grid.innerHTML = list
        .map((r) => {
          const title = r.title || "제목 없는 레시피";
          const category = r.category || "기타";
          const views = r.views || 0;
          const thumb = r.image || r.thumbnail || "11_default.png";
          const link =
            "11_인공띠용지능_recipe.html?id=" +
            encodeURIComponent(String(r.id));

          return `
            <a href="${link}" class="card">
              <img src="${thumb}" alt="${title}" class="thumb" />
              <div>
                <p class="card-title">${title}</p>
                <p class="card-sub">${category} · 조회수 ${views}</p>
              </div>
            </a>
          `;
        })
        .join("");
    }

    function renderSavedList() {
      const savedListContainer = document.getElementById("saved-list");
      if (!savedListContainer) return;

      const savedRecipes =
        JSON.parse(localStorage.getItem(SAVED_RECIPES_KEY)) || [];

      if (savedRecipes.length === 0) {
        savedListContainer.innerHTML =
          '<li style="padding:20px; text-align:center; color:#999;">저장된 레시피가 없습니다.</li>';
      } else {
        savedListContainer.innerHTML = savedRecipes
          .map(
            (recipe) => `
            <li>
              <a href="${recipe.link}" class="list-item">
                <div class="list-text">
                  <p class="list-ttl">${recipe.title}</p>
                  <p class="list-sub">${recipe.subInfo || ""}</p>
                </div>
              </a>
            </li>
          `
          )
          .join("");
      }
    }

    function renderRecentList() {
      const recentListContainer = document.getElementById("recent-list");
      if (!recentListContainer) return;

      const recentRecipes =
        JSON.parse(localStorage.getItem(RECENT_RECIPES_KEY)) || [];

      if (recentRecipes.length === 0) {
        recentListContainer.innerHTML =
          '<li style="padding:20px; text-align:center; color:#999;">최근 본 레시피가 없습니다.</li>';
      } else {
        recentListContainer.innerHTML = recentRecipes
          .map(
            (recipe) => `
            <li>
              <a href="${recipe.link}" class="list-item">
                <div class="list-text">
                  <p class="list-ttl">${recipe.title}</p>
                  <p class="list-sub">${recipe.info}</p>
                </div>
              </a>
            </li>
          `
          )
          .join("");
      }
    }

    // --- 초기화 ---
    document.addEventListener("DOMContentLoaded", function () {
      const userNameEl = document.querySelector(".profile-name");
      const userName = userNameEl ? userNameEl.textContent.trim() : "";
      if (userName) {
        localStorage.setItem("nn_username", userName);
      }

      let myRecipes = loadLocalRecipes();
      renderMyRecipeCount(myRecipes);
      renderMyRecipesGrid(myRecipes);

      renderSavedList();
      renderRecentList();
    });
  </script>

  

  </body>
</html>

<!DOCTYPE html>
<html lang="ko" id="top">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>냠냠노트 - 마이페이지</title>
  <link rel="stylesheet" href="11_인공띠용지능_NamyamNote_style.css" />

  <style>
    .follow {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #f9fafb;
      border-top: 1px solid var(--border);
      padding: 12px 8px;
    }
    .follow > div {
      flex: 1;
      text-align: center;
      cursor: pointer;
    }
    .follow-num {
      font-weight: 800;
      font-size: 20px;
    }
    .follow-label {
      font-size: 13px;
      color: var(--muted);
    }

    /* ---------------------- */
    /* Follow Modal           */
    /* ---------------------- */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9000;
    }
    .modal-box {
      width: 90%;
      max-width: 420px;
      background: #fff;
      border-radius: 16px;
      padding: 20px;
      box-shadow: var(--shadow-lg);
      max-height: 80vh;
      overflow-y: auto;
    }
    .modal-title {
      font-size: 20px;
      font-weight: 800;
      margin-bottom: 16px;
    }
    .user-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 4px;
      border-bottom: 1px solid #eee;
    }
    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .user-info img {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      object-fit: cover;
      background: #eee;
    }
    .user-nickname {
      font-weight: 700;
      font-size: 15px;
    }
    .user-username {
      font-size: 12px;
      color: var(--muted);
    }
    .btn-follow-toggle {
      padding: 6px 14px;
      border-radius: 12px;
      font-size: 13px;
      border: 1px solid var(--border);
      cursor: pointer;
      background: #fff;
    }
    .btn-follow-toggle.following {
      background: var(--primary-color);
      color: #fff;
      border-color: var(--primary-color);
    }
  </style>
</head>

<body>
<!-- ========== 상단 네비 ========== -->
<nav class="site-nav">
  <div class="container nav-top-center">
    <div class="nav-center-box">
      <a href="11_인공띠용지능_main.html">
        <img src="11_logo.png" class="logo" />
      </a>
      <div class="nav-search">
        <input class="nav-search-input" placeholder="재료명으로 레시피 검색" />
        <button class="nav-search-btn">
          <svg width="18" height="18" fill="none"><circle cx="11" cy="11" r="7" stroke="white" stroke-width="2"/><line x1="16.5" y1="16.5" x2="21" y2="21" stroke="white" stroke-width="2"/></svg>
        </button>
      </div>
    </div>
  </div>

  <div class="nav-menu-bar">
    <a class="nav-link" href="11_인공띠용지능_main.html">홈</a>
    <a class="nav-link" href="11_인공띠용지능_menulist.html">레시피</a>
    <a class="nav-link" href="11_인공띠용지능_register.html">등록</a>
    <a class="nav-link" href="11_인공띠용지능_rank.html">랭킹</a>
    <a class="nav-link" href="11_인공띠용지능_mypage.html">마이페이지</a>
  </div>
</nav>

<main class="container page-pad">

  <!-- ========== 프로필 헤더 ========== -->
  <section class="profile-header">
    <div class="profile-cover"></div>

    <div class="profile-box">
      <div style="margin-top:-43px;width:88px;height:88px;">
        <img src="11_circle_h_icon.png" alt="프로필 이미지" style="width:100%;height:100%;border-radius:50%;" />
      </div>

      <h1 class="profile-name">Haein_Cook</h1>
      <p class="profile-id">@haein_cook</p>
      <p class="profile-bio">안녕하세요!</p>

      <a href="11_인공띠용지능_edit-profile.html" class="btn-outline" style="margin-top:18px;">
        프로필 수정
      </a>
    </div>

    <!-- Follow Count -->
    <div class="follow">
      <div id="btn-my-posts"><strong class="follow-num" id="count-my">0</strong><span class="follow-label">내 레시피</span></div>
      <div id="btn-following"><strong class="follow-num" id="count-following">0</strong><span class="follow-label">팔로잉</span></div>
      <div id="btn-followers"><strong class="follow-num" id="count-followers">0</strong><span class="follow-label">팔로워</span></div>
    </div>
  </section>

  <!-- 저장한 레시피 + 최근 본 레시피 -->
  <section class="grid-2" style="gap:24px;margin-top:80px">
    <div class="card-box">
      <div class="bar" style="justify-content:space-between">
        <h3 class="card-title-lg">저장한 레시피</h3>
        <a href="11_인공띠용지능_saved_list.html" class="badge">더보기</a>
      </div>
      <ul class="list-v" id="saved-list"></ul>
    </div>

    <div class="card-box">
      <div class="bar" style="justify-content:space-between">
        <h3 class="card-title-lg">최근 본 레시피</h3>
        <a href="11_인공띠용지능_recent_list.html" class="badge">더보기</a>
      </div>
      <ul class="list-v" id="recent-list"></ul>
    </div>
  </section>

  <!-- 내가 등록한 레시피 -->
  <section class="card-box" style="margin-top:80px;">
    <div class="bar" style="justify-content:space-between">
      <h3 class="card-title-lg">내가 등록한 레시피</h3>
      <div class="btn-row">
        <a href="11_인공띠용지능_register.html" class="btn-solid">새 레시피 등록</a>
        <a href="11_인공띠용지능_recipe_manage.html" class="btn-warn">레시피 관리</a>
      </div>
    </div>
    <div class="card-grid my-recipes" id="my-recipes-grid"></div>
  </section>

  <!-- 로그아웃 -->
  <div style="margin-top:20px;text-align:right;">
    <a href="#logout" class="btn-warn">로그아웃</a>
  </div>

  <a href="#top" class="to-top">맨 위로 ↑</a>
</main>

<!-- ========== 팔로워/팔로잉 Modal ========== -->
<div class="modal-overlay" id="followModal">
  <div class="modal-box">
    <div class="modal-title" id="followModalTitle"></div>
    <div id="followListContainer"></div>
    <button style="margin-top:18px;width:100%;padding:10px 0;border-radius:12px;border:1px solid #ccc;background:#fafafa;cursor:pointer;"
            onclick="closeFollowModal()">닫기</button>
  </div>
</div>

<!-- FOLLOW LIST SCRIPT -->
<script>
const FOLLOW_JSON = "11_인공띠용지능_followlist.json";
let followData = { following: [], followers: [] };

// JSON 파일 로드
async function loadFollowList() {
  try {
    const res = await fetch(FOLLOW_JSON + "?v=" + Date.now());
    followData = await res.json();
  } catch {
    followData = { following: [], followers: [] };
  }
  updateFollowCounts();
}

// 팔로우/언팔 토글
function toggleFollow(userId) {
  const idx = followData.following.indexOf(userId);

  if (idx === -1) {
    followData.following.push(userId);
  } else {
    followData.following.splice(idx, 1);
  }

  saveFollowList();
  updateFollowCounts();
  renderFollowList(currentModalType);
}

// JSON 저장(로컬 시뮬레이트)
function saveFollowList() {
  localStorage.setItem("nn_followlist", JSON.stringify(followData));
}

// 로컬 저장된 follow 리스트 복구
function loadLocalOverride() {
  const saved = localStorage.getItem("nn_followlist");
  if (saved) followData = JSON.parse(saved);
}

function updateFollowCounts() {
  document.getElementById("count-following").textContent = followData.following.length;
  document.getElementById("count-followers").textContent = followData.followers.length;
}

function closeFollowModal() {
  document.getElementById("followModal").style.display = "none";
}

let currentModalType = "following";

function openFollowModal(type) {
  currentModalType = type;
  document.getElementById("followModalTitle").textContent =
    type === "followers" ? "팔로워 목록" : "팔로잉 목록";
  renderFollowList(type);
  document.getElementById("followModal").style.display = "flex";
}

function renderFollowList(type) {
  const box = document.getElementById("followListContainer");
  const arr = followData[type];

  if (arr.length === 0) {
    box.innerHTML = `<p style="padding:20px;color:#999;text-align:center;">아직 없음</p>`;
    return;
  }

  box.innerHTML = arr
    .map(
      userId => `
      <div class="user-item">
        <div class="user-info">
          <img src="11_circle_h_icon.png" />
          <div>
            <div class="user-nickname">${userId}</div>
            <div class="user-username">@${userId}</div>
          </div>
        </div>

        <button class="btn-follow-toggle ${followData.following.includes(userId) ? "following" : ""}"
            onclick="toggleFollow('${userId}')">
          ${followData.following.includes(userId) ? "언팔로우" : "팔로우"}
        </button>
      </div>
    `
    )
    .join("");
}

document.getElementById("btn-following").onclick = () => openFollowModal("following");
document.getElementById("btn-followers").onclick = () => openFollowModal("followers");

// 검색
document.addEventListener("DOMContentLoaded", () => {
  const navInput = document.querySelector(".nav-search-input");
  const navBtn = document.querySelector(".nav-search-btn");

  navBtn.addEventListener("click", () => {
    const kw = navInput.value.trim();
    if (!kw) return alert("검색어를 입력해주세요!");
    location.href = "11_인공띠용지능_search.html?keyword=" + encodeURIComponent(kw);
  });

  navInput.addEventListener("keydown", e => {
    if (e.key === "Enter") navBtn.click();
  });
});

// 초기 실행
loadFollowList();
loadLocalOverride();
</script>

<!-- 내 레시피, 저장/최근 레시피 렌더링 -->
<script>
const LOCAL_RECIPES_KEY = "nn_recipes";
const SAVED_RECIPES_KEY = "nn_saved_recipes";
const RECENT_RECIPES_KEY = "nn_recent_recipes";

function loadMyRecipes() {
  try {
    return JSON.parse(localStorage.getItem(LOCAL_RECIPES_KEY)) || [];
  } catch {
    return [];
  }
}

function renderMyRecipeCount(list) {
  document.getElementById("count-my").textContent = list.length;
}

function renderMyRecipesGrid(list) {
  const grid = document.getElementById("my-recipes-grid");
  if (list.length === 0) {
    grid.innerHTML = `<p style="padding:20px;color:#999;">아직 등록한 레시피가 없습니다.</p>`;
    return;
  }
  grid.innerHTML = list
    .map(r => `
      <a href="11_인공띠용지능_recipe.html?id=${r.id}" class="card">
        <img src="${r.image || '11_default.png'}" class="thumb" />
        <p class="card-title">${r.title}</p>
        <p class="card-sub">${r.category} · 조회수 ${r.views}</p>
      </a>
    `)
    .join("");
}

function renderSavedList() {
  const saved = JSON.parse(localStorage.getItem(SAVED_RECIPES_KEY)) || [];
  const el = document.getElementById("saved-list");
  if (saved.length === 0) {
    el.innerHTML = '<li style="padding:20px;color:#999;text-align:center;">없음</li>';
    return;
  }
  el.innerHTML = saved
    .slice(0, 3)
    .map(r => `
      <li><a href="${r.link}" class="list-item">
        <div class="list-text">
          <p class="list-ttl">${r.title}</p>
          <p class="list-sub">${r.subInfo || ''}</p>
        </div>
      </a></li>
    `).join("");
}

function renderRecentList() {
  const recent = JSON.parse(localStorage.getItem(RECENT_RECIPES_KEY)) || [];
  const el = document.getElementById("recent-list");
  if (recent.length === 0) {
    el.innerHTML = '<li style="padding:20px;color:#999;text-align:center;">없음</li>';
    return;
  }
  el.innerHTML = recent
    .slice(0, 3)
    .map(r => `
      <li><a href="${r.link}" class="list-item">
        <div class="list-text">
          <p class="list-ttl">${r.title}</p>
          <p class="list-sub">${r.info || ''}</p>
        </div>
      </a></li>
    `).join("");
}

document.addEventListener("DOMContentLoaded", () => {
  const myRecipes = loadMyRecipes();

  renderMyRecipeCount(myRecipes);
  renderMyRecipesGrid(myRecipes);

  renderSavedList();
  renderRecentList();
});
</script>

</body>
</html>

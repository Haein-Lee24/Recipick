<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë ˆì‹œí”¼ ì „ì²´ë³´ê¸°</title>
    <link rel="stylesheet" href="11_ì¸ê³µë ìš©ì§€ëŠ¥_NamyamNote_style.css" />

    <style>
      main {
        margin-top: 40px;
      }

      /* ìƒë‹¨ ì˜ì—­ ì „ì²´ */
      .header-area {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 60px;
        margin-bottom: 2px;
      }

      /* ì œëª© (ë§¨ ìœ„, ê°€ìš´ë°) */
      .header-area h2 {
        margin: 10;
        text-align: center;
        font-size: 24px;
        padding-bottom: 20px; /* ì„ ê³¼ í…ìŠ¤íŠ¸ ì‚¬ì´ ê°„ê²© */
        border-bottom: 1px solid #ded3c4 !important;
        width: 100%;  
      }

      .section-title {
        border-bottom: none !important;
      }


      /* ì œëª© ì•„ë˜ì¤„: ë’¤ë¡œê°€ê¸° + ì •ë ¬ë°” í•œ ì¤„ */
      .header-controls {
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .back-btn {
        padding: 8px 20px;
        background: #eee;
        border-radius: 80px;
        text-decoration: none;
        color: #333;
        font-size: 14px;
      }

      .sort-area {
        display: flex;
        align-items: center;
        gap: 6px;
        margin-top: 30px;
      }
    </style>
  </head>

  <body>
    <!-- ì‚¬ì´íŠ¸ ê³µí†µ ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="site-nav">
  <div class="container nav-top-center">
    <div class="nav-center-box">
      <a href="11_ì¸ê³µë ìš©ì§€ëŠ¥_main.html" aria-label="ëƒ ëƒ ë…¸íŠ¸ í™ˆ">
        <img src="11_logo.png" alt="ëƒ ëƒ ë…¸íŠ¸ ë¡œê³ " class="logo" />
      </a>

      <div class="nav-search">
        <input
          type="text"
          placeholder="ì¬ë£Œëª…ìœ¼ë¡œ ë ˆì‹œí”¼ ê²€ìƒ‰"
          class="nav-search-input"
        />
        <button class="nav-search-btn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <circle cx="11" cy="11" r="7" stroke="white" stroke-width="2" />
            <line x1="16.5" y1="16.5" x2="21" y2="21" stroke="white" stroke-width="2" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <div class="nav-menu-bar">
    <a class="nav-link" href="11_ì¸ê³µë ìš©ì§€ëŠ¥_main.html">í™ˆ</a>
    <a class="nav-link active" href="11_ì¸ê³µë ìš©ì§€ëŠ¥_menulist_full.html">ë ˆì‹œí”¼</a>
    <a class="nav-link" href="11_ì¸ê³µë ìš©ì§€ëŠ¥_register.html">ë“±ë¡</a>
    <a class="nav-link" href="11_ì¸ê³µë ìš©ì§€ëŠ¥_rank.html">ë­í‚¹</a>
    <a class="nav-link" href="11_ì¸ê³µë ìš©ì§€ëŠ¥_mypage.html">ë§ˆì´í˜ì´ì§€</a>
  </div>
</nav>


    <main class="container page-pad">
      <!-- ìƒë‹¨: ì œëª© + (ë’¤ë¡œê°€ê¸° & ì •ë ¬ë°”) -->
      <div class="header-area">
        <!-- ğŸ”º ë§¨ ìœ„ ì œëª© -->
        <h2 id="full-title" class="section-title">ë¡œë”© ì¤‘...</h2>

        <!-- ğŸ”» ê·¸ ë°”ë¡œ ì•„ë˜ ì¤„: ë’¤ë¡œê°€ê¸° + ì •ë ¬ -->
        <div class="header-controls">
          <a href="11_ì¸ê³µë ìš©ì§€ëŠ¥_menulist.html" class="back-btn">
            â† ì¹´í…Œê³ ë¦¬ë³„ ëª©ë¡ìœ¼ë¡œ
          </a>

          <div class="sort-area">
            <label for="sort-select">ì •ë ¬:</label>
            <select id="sort-select">
              <option value="name">ì´ë¦„ìˆœ(ê¸°ë³¸)</option>
              <option value="views">ì¸ê¸°ìˆœ(ì¡°íšŒìˆ˜ ë§ì€ìˆœ)</option>
              <option value="rating">í‰ì  ë†’ì€ìˆœ</option>
            </select>
          </div>
        </div>
      </div>

      <!-- ë ˆì‹œí”¼ ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ê°€ ì¶œë ¥ë  ì˜ì—­ -->
      <div id="full-list" class="card-grid"></div>
    </main>

    <script>
      /* ----------------------------------------
        URL íŒŒë¼ë¯¸í„°ì—ì„œ category ê°’ ì½ê¸°
      ---------------------------------------- */
      const params = new URLSearchParams(window.location.search);
      const currentCategory = params.get("category");

      /* ----------------------------------------
        JSON ë‚´ë¶€ ì¹´í…Œê³ ë¦¬(í•œê¸€)ì™€ URL íŒŒë¼ë¯¸í„°(ì˜ì–´) ë§¤í•‘
      ---------------------------------------- */
      const categoryMap = {
        korean: "í•œì‹",
        western: "ì–‘ì‹",
        chinese: "ì¤‘ì‹",
        dessert: "ë””ì €íŠ¸",
        drink: "ìŒë£Œ",
      };

      // localStorage key
      const STORAGE_KEY = "nn_recipes";

      function getDefaultImage(korCategory) {
        switch (korCategory) {
          case "í•œì‹":
            return "11_kimchi.jpg";
          case "ì–‘ì‹":
            return "11_pasta.jpg";
          case "ì¤‘ì‹":
            return "11_chinese.png";
          case "ë””ì €íŠ¸":
            return "11_snack.jpg";
          case "ìŒë£Œ":
            return "11_drink.png";
          default:
            return "11_pasta.jpg";
        }
      }

      function loadUserRecipes(targetName, isDessertMode) {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return [];
          const all = JSON.parse(raw);

          return all.filter((u) => {
            if (isDessertMode) {
              return u.category === "ë””ì €íŠ¸" || u.category === "ê°„ì‹";
            }
            return u.category === targetName;
          });
        } catch (e) {
          console.error("ìœ ì € ë ˆì‹œí”¼ íŒŒì‹± ì˜¤ë¥˜:", e);
          return [];
        }
      }

      function makeCardHTML(title, thumbnail, metaText, ratingText, href) {
        return `
          <a href="${href}" class="card">
            <img src="${thumbnail}" alt="${title}" class="thumb" />
            <div class="card-body">
              <p class="card-title">${title}</p>
              <p class="recipe-meta">${metaText}</p>
              <div class="rating">${ratingText}</div>
            </div>
          </a>
        `;
      }

      fetch("11_ì¸ê³µë ìš©ì§€ëŠ¥_recipes.json")
        .then((res) => res.json())
        .then((data) => {
          const titleEl = document.getElementById("full-title");
          const listEl = document.getElementById("full-list");
          const sortSelect = document.getElementById("sort-select");

          const targetName = categoryMap[currentCategory];

          // ì˜ëª»ëœ category ì²˜ë¦¬
          if (!targetName) {
            titleEl.innerText = "ì˜ëª»ëœ ì¹´í…Œê³ ë¦¬ì…ë‹ˆë‹¤.";
            return;
          }

          const isDessertMode = currentCategory === "dessert";

          // JSON ë ˆì‹œí”¼
          const jsonRecipes = data.recipes.filter((r) => {
            if (isDessertMode)
              return r.category === "ë””ì €íŠ¸" || r.category === "ê°„ì‹";
            return r.category === targetName;
          });

          // localStorage ë ˆì‹œí”¼
          const userRecipes = loadUserRecipes(targetName, isDessertMode);

          // ì „ì²´ ë¦¬ìŠ¤íŠ¸ í•©ì¹˜ê¸°
          let fullList = [...jsonRecipes, ...userRecipes];

          // ì œëª© í‘œê¸°
          titleEl.innerText = `ì „ì²´ ${targetName} ë ˆì‹œí”¼ (ì´ ${fullList.length}ê°œ)`;

          if (fullList.length === 0) {
            listEl.innerHTML = "<p>ë“±ë¡ëœ ë ˆì‹œí”¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
            return;
          }

          function sortList(type) {
            if (type === "name") {
              fullList.sort((a, b) =>
                a.title.localeCompare(b.title, "ko-KR")
              );
            }

            if (type === "views") {
              fullList.sort((a, b) => {
                const A = a.review_count
                  ? Number(a.review_count)
                  : Number(a.views || 0);
                const B = b.review_count
                  ? Number(b.review_count)
                  : Number(b.views || 0);
                return B - A;
              });
            }

            if (type === "rating") {
              fullList.sort(
                (a, b) => Number(b.rating) - Number(a.rating)
              );
            }

            renderCards();
          }

          function renderCards() {
            listEl.innerHTML = fullList
              .map((r) => {
                const href = `11_ì¸ê³µë ìš©ì§€ëŠ¥_recipe.html?id=${r.id}`;
                const thumb =
                  r.thumbnail || r.image || getDefaultImage(r.category);

                const meta = `ì‘ì„±ì: ${r.author || "ëƒ ëƒ ì´"} Â· ì¡°íšŒìˆ˜ ${r.review_count || 0}`;


                const rating = `â˜… ${Number(r.rating).toFixed(1)}`;

                return makeCardHTML(
                  r.title,
                  thumb,
                  meta,
                  rating,
                  href
                );
              })
              .join("");
          }

          // ì´ˆê¸° ì •ë ¬: ì´ë¦„ìˆœ
          sortList("name");

          // ì •ë ¬ UI ì´ë²¤íŠ¸
          sortSelect.addEventListener("change", () => {
            sortList(sortSelect.value);
          });
        })
        .catch((err) => console.error("ë¡œë”© ì‹¤íŒ¨:", err));
    </script>

    <script>
document.addEventListener("DOMContentLoaded", () => {
  const navInput = document.querySelector(".nav-search-input");
  const navBtn = document.querySelector(".nav-search-btn");

  if (!navInput || !navBtn) return;

  navBtn.addEventListener("click", () => {
    const kw = navInput.value.trim();
    if (!kw) {
      alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
      return;
    }

    location.href =
      "11_ì¸ê³µë ìš©ì§€ëŠ¥_search.html?keyword=" +
      encodeURIComponent(kw);
  });

  navInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") navBtn.click();
  });
});
</script>

  </body>
</html>

<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë ˆì‹œí”¼ ì „ì²´ë³´ê¸°</title>
    <link rel="stylesheet" href="11_ì¸ê³µë ìš©ì§€ëŠ¥_NamyamNote_style.css" />
    <style>
      main {
        margin-top: 40px;
      }
      .header-area {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: none !important;
      }
      .back-btn {
        padding: 8px 16px;
        background: #eee;
        border-radius: 8px;
        text-decoration: none;
        color: #333;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <nav class="site-nav">
      <div class="container nav-inner">
        <div class="logo-area">
          <a href="11_ì¸ê³µë ìš©ì§€ëŠ¥_main.html">
            <img src="11_logo.png" alt="Logo" class="logo" />
          </a>
        </div>
        <div class="menu">
          <a class="nav-link" href="11_ì¸ê³µë ìš©ì§€ëŠ¥_main.html">í™ˆ</a>
          <a class="active nav-link" href="11_ì¸ê³µë ìš©ì§€ëŠ¥_menulist.html">
            ë ˆì‹œí”¼
          </a>
          <a class="nav-link" href="11_ì¸ê³µë ìš©ì§€ëŠ¥_register.html">ë“±ë¡</a>
          <a class="nav-link" href="11_ì¸ê³µë ìš©ì§€ëŠ¥_rank.html">ë­í‚¹</a>
          <a class="nav-link" href="11_ì¸ê³µë ìš©ì§€ëŠ¥_mypage.html">ë§ˆì´í˜ì´ì§€</a>
        </div>
      </div>
    </nav>

    <main class="container page-pad">
      <div class="header-area">
        <h2 id="full-title" class="section-title">ë¡œë”© ì¤‘...</h2>
        <a href="11_ì¸ê³µë ìš©ì§€ëŠ¥_menulist.html" class="back-btn">â† ëª©ë¡ìœ¼ë¡œ</a>
      </div>
      <div id="full-list" class="card-grid"></div>
    </main>

    <script>
      // URL íŒŒë¼ë¯¸í„° ì½ê¸° (?category=korean / western / chinese / dessert / drink)
      const params = new URLSearchParams(window.location.search);
      const currentCategory = params.get("category");

      // JSONì—ì„œ ì‚¬ìš©í•˜ëŠ” ì¹´í…Œê³ ë¦¬ ì´ë¦„ ë§¤í•‘
      const categoryMap = {
        korean: "í•œì‹",
        western: "ì–‘ì‹",
        chinese: "ì¤‘ì‹",
        dessert: "ë””ì €íŠ¸",
        drink: "ìŒë£Œ",
      };

      // localStorageì— ì €ì¥ëœ ìœ ì € ë ˆì‹œí”¼ key (register.jsì™€ ë™ì¼)
      const STORAGE_KEY = "nn_recipes";

      // ì¹´í…Œê³ ë¦¬ë³„ ê¸°ë³¸ ì¸ë„¤ì¼ ì´ë¯¸ì§€
      function getDefaultImage(korCategory) {
        switch (korCategory) {
          case "í•œì‹":
            return "11_kimchi.jpg";
          case "ì–‘ì‹":
            return "11_pasta.jpg";
          case "ì¤‘ì‹":
            return "11_chinese.png";
          case "ë””ì €íŠ¸":
            return "11_snack.jpg";
          case "ìŒë£Œ":
            return "11_drink.png";
          default:
            return "11_pasta.jpg";
        }
      }

      // localStorageì—ì„œ ìœ ì € ë ˆì‹œí”¼ ê°€ì ¸ì˜¤ê¸°
      function loadUserRecipes(targetName, isDessertMode) {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return [];

          const all = JSON.parse(raw); // [{id,title,category,image,...}, ...]

          return all.filter((u) => {
            if (isDessertMode) {
              // ë””ì €íŠ¸ëŠ” 'ë””ì €íŠ¸' + 'ê°„ì‹' ë‘˜ ë‹¤ í¬í•¨
              return u.category === "ë””ì €íŠ¸" || u.category === "ê°„ì‹";
            }
            return u.category === targetName;
          });
        } catch (e) {
          console.error("ìœ ì € ë ˆì‹œí”¼ íŒŒì‹± ì˜¤ë¥˜:", e);
          return [];
        }
      }

      // ì¹´ë“œ HTML ê³µí†µ í…œí”Œë¦¿
      function makeCardHTML(title, thumbnail, metaText, ratingText, href) {
        return `
          <a href="${href}" class="card">
            <img src="${thumbnail}" alt="${title}" class="thumb" />
            <div class="card-body">
              <p class="card-title">${title}</p>
              <p class="recipe-meta">${metaText}</p>
              <div class="rating">${ratingText}</div>
            </div>
          </a>
        `;
      }

      // ë©”ì¸ ë Œë”ë§ ë¡œì§
      fetch("11_ì¸ê³µë ìš©ì§€ëŠ¥_recipes.json")
        .then((res) => res.json())
        .then((data) => {
          const titleEl = document.getElementById("full-title");
          const listEl = document.getElementById("full-list");
          const targetName = categoryMap[currentCategory]; // 'í•œì‹' / 'ì–‘ì‹' ...

          if (!targetName) {
            titleEl.innerText = "ì˜ëª»ëœ ì¹´í…Œê³ ë¦¬ì…ë‹ˆë‹¤.";
            return;
          }

          const isDessertMode = currentCategory === "dessert";

          // 1) JSON ì›ë³¸ ë ˆì‹œí”¼ í•„í„°ë§
          const jsonRecipes = data.recipes.filter((r) => {
            if (isDessertMode) {
              // ë””ì €íŠ¸ íƒ­ì—ì„œëŠ” 'ë””ì €íŠ¸' + 'ê°„ì‹'
              return r.category === "ë””ì €íŠ¸" || r.category === "ê°„ì‹";
            }
            return r.category === targetName;
          });

          // 2) localStorageì—ì„œ ìœ ì € ë ˆì‹œí”¼ í•„í„°ë§
          const userRecipes = loadUserRecipes(targetName, isDessertMode);

          // 3) ì´ ê°œìˆ˜ë¡œ ì œëª© ì„¸íŒ…
          const totalCount = jsonRecipes.length + userRecipes.length;
          titleEl.innerText = `ì „ì²´ ${targetName} ë ˆì‹œí”¼ (ì´ ${totalCount}ê°œ)`;

          // 4) JSON + ìœ ì € ë‘˜ ë‹¤ ë¹„ì—ˆì„ ë•Œ
          if (jsonRecipes.length === 0 && userRecipes.length === 0) {
            listEl.innerHTML = "<p>ë“±ë¡ëœ ë ˆì‹œí”¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
            return;
          }

          // 5) JSON ë ˆì‹œí”¼ ì¹´ë“œ HTML
          const jsonCardsHTML = jsonRecipes
            .map((r) => {
              const href = `11_ì¸ê³µë ìš©ì§€ëŠ¥_recipe.html?id=${r.id}`;
              const thumb = r.thumbnail || getDefaultImage(r.category);
              const meta = `ì‘ì„±ì: ëƒ ëƒ ì´ Â· ë¦¬ë·° ${r.review_count}ê°œ`;
              const rating = `â˜… ${r.rating}`;
              return makeCardHTML(r.title, thumb, meta, rating, href);
            })
            .join("");

          // 6) ìœ ì € ë ˆì‹œí”¼ ì¹´ë“œ HTML
// 6) ìœ ì € ë ˆì‹œí”¼ ì¹´ë“œ HTML
          const userCardsHTML = userRecipes
            .map((u) => {
              // ğŸ”¥ ì—¬ê¸°! ì´ì œ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ë„ë¡ ìˆ˜ì •
              const href = `11_ì¸ê³µë ìš©ì§€ëŠ¥_recipe.html?id=${u.id}`;
              const thumb = u.image || getDefaultImage(u.category);
              const meta = `ì‘ì„±ì: ì‚¬ìš©ì Â· ì¡°íšŒìˆ˜ ${u.views || 0}`;
              const ratingValue =
                typeof u.rating === "number" ? u.rating.toFixed(1) : u.rating || 0;
              const rating = `â˜… ${ratingValue}`;
              return makeCardHTML(u.title, thumb, meta, rating, href);
            })
            .join("");


          // 7) JSON â†’ ìœ ì € ìˆœìœ¼ë¡œ ì¹´ë“œ ì¶œë ¥
          listEl.innerHTML = jsonCardsHTML + userCardsHTML;
        })
        .catch((err) => console.error("ë¡œë”© ì‹¤íŒ¨:", err));
    </script>
  </body>
</html>
